<!doctype html>
<html>
<head>
  <title>Threeflow</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="js/dat.gui.js"></script>

  <script src="js/three.js"></script>
  <script src="js/threeflow.js"></script>

  <script src="js/OrbitControls.js"></script>
  <script src="js/TransformControls.js"></script>

  <script src="js/BinaryLoader.js"></script>

</head>
<style>
  body{
    background-color: #131313;
    margin:0px;
    padding:0px;
    overflow:scroll;
  }
</style>
<body>
<script>

  var width, height, threeflow, lighting, gui;
  var camera, scene, renderer;

  init();
  update();

  function init() {

    // ###
    // Threeflow Basic setup

    width = 800; height = 600;

    threeflow = new THREEFLOW.SunflowRenderer({overwrite:true});
    threeflow.setSize( width,height );

    renderer = new THREE.WebGLRenderer();
    renderer.setSize( width,height );

    document.body.appendChild( renderer.domElement );
    var img = document.body.appendChild( document.createElement("img") );
    img.src = "renders/camaro.png";

    scene = new THREE.Scene();

    camera = new THREE.PerspectiveCamera( 35, width/height, 1, 30000 );
    camera.position.set(0,500,1000);
    camera.lookAt( new THREE.Vector3() );

    lighting = new THREEFLOW.LightingRig(camera,renderer.domElement);
    lighting.loadState('{"keyRadiance":30,"lights":[{"enabled":true,"color":16777199,"keyRatio":0,"radiance":30,"geometryType":"Plane","target":{"x":-211.9274872502022,"y":275.85083879734725,"z":170.55557980904268},"light":{"x":-413.19648050640706,"y":287.7592534400846,"z":339.4519703473842,"sx":0.6029171577908687,"sy":0.6029171577908687,"sz":0.6029171577908687}},{"enabled":true,"color":16777199,"keyRatio":6,"radiance":5,"geometryType":"Plane","target":{"x":217.81041418261862,"y":234.43664495539383,"z":176.3440939438861},"light":{"x":499.3922690493239,"y":227.98373335764214,"z":518.5831468458007,"sx":0.7423625401435991,"sy":0.7423625401435991,"sz":0.7423625401435991}},{"enabled":false,"color":16777199,"keyRatio":2,"radiance":15,"geometryType":"Plane","target":{"x":-207.30188165286313,"y":322.15255588531136,"z":-131.85555947333944},"light":{"x":-508.73030977652644,"y":342.73245422110296,"z":-437.30864347816487,"sx":0.5251717408652797,"sy":0.5251717408652797,"sz":0.5251717408652797}},{"enabled":false,"color":16777199,"keyRatio":8,"radiance":3.75,"geometryType":"Plane","target":{"x":405.4561720515609,"y":128.06773481919686,"z":-716.9348712525214},"light":{"x":762.4879099396458,"y":310.9158695184617,"z":-409.34363940372657,"sx":1.1752789471525573,"sy":1.1752789471525573,"sz":1.1752789471525573}}]}')
    scene.add( lighting );

    gui = new THREEFLOW.Gui(threeflow,lighting);
    gui.onRender.add( function(){
      threeflow.render( scene, camera, "camaro" );
    });


    var mesh,material;

    var loader = new THREE.BinaryLoader();

    loader.load("/models/CamaroNoUv_bin.js",function(geometry){
      geometry.computeBoundingBox();

      var scale = 200 / ( geometry.boundingBox.max.y - geometry.boundingBox.min.y );

      var body,chrome,glass,tire,interior,black;
      body = new THREEFLOW.ShinyMaterial( {color: 0xff6600, reflectivity: 0.3} );
      chrome = new THREEFLOW.MirrorMaterial( {color: 0xffffff,reflection: 0xffffff} );
      glass = new THREEFLOW.GlassMaterial( {color: 0x223344, eta:1.0, opacity: 0.25, transparent: true } );
      tire = new THREEFLOW.DiffuseMaterial( {color: 0x050505} );
      interior = new THREE.MeshPhongMaterial( { color: 0x050505, shininess: 20} );
      black = new THREE.MeshLambertMaterial( {color: 0x000000} );

      // body,wheels,grill,door lines,windshield,interior,tire,tireling,behind grill
      material = new THREE.MeshFaceMaterial([body,chrome,chrome,chrome,glass,interior,tire,black,black]);

      mesh = new THREE.Mesh(geometry,material);

      mesh.scale.set(scale,scale,scale);
      mesh.position.y = geometry.boundingBox.max.y*scale;
      mesh.rotation.y = -(Math.PI/4);

      scene.add(mesh);
    });
  }

  function update() {
    requestAnimationFrame( update );

    lighting.update();
    renderer.render( scene, camera );
  }

</script>
</body>
</html>